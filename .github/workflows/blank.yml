# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "maven-gpg" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  execuction-configuration:
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v3

      - name: Import GPG private key
        env:
          MAVEN_GPG_PRIVATE_KEY: ${{ secrets.MAVEN_GPG_PRIVATE_KEY }}
        run: |
          f=`mktemp`
          echo "${MAVEN_GPG_PRIVATE_KEY}" > "$f"
          gpg --batch --import-options import-show --import "$f"

      - name: Set up pom.xml
        run: cp pom-execution-configuration.xml pom.xml

      - name: Build with Apache Maven
        env:
          MAVEN_GPG_PASSPHRASE: ${{ secrets.MAVEN_GPG_PASSPHRASE }}
        run: mvn --batch-mode verify gpg:sign

  plugin-configuration:
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v3

      - name: Import GPG private key
        env:
          MAVEN_GPG_PRIVATE_KEY: ${{ secrets.MAVEN_GPG_PRIVATE_KEY }}
        run: |
          f=`mktemp`
          echo "${MAVEN_GPG_PRIVATE_KEY}" > "$f"
          gpg --batch --import-options import-show --import "$f"

      - name: Set up pom.xml
        run: cp pom-plugin-configuration.xml pom.xml

      - name: Build with Apache Maven
        env:
          MAVEN_GPG_PASSPHRASE: ${{ secrets.MAVEN_GPG_PASSPHRASE }}
        run: mvn --batch-mode verify gpg:sign
